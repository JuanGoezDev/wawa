<!DOCTYPE html>
<html lang="en">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <style>
            #div_container_login{
                margin-left: 10%;
                margin-right: 10%;
                margin-top:5%;
                padding:10%;
                border-style: solid;
                border-color: black;
                border-radius: 20px;
            }

            #div_container_resetPassword{
                margin-left: 10%;
                margin-right: 10%;
                margin-top:5%;
                padding:10%;
                border-style: solid;
                border-color: black;
                border-radius: 20px;
            }

            input{
                margin-bottom: 10px;
            }

            #h2_logState{
                margin-top: 10px;
            }
        </style>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>WAWA Login</title>
    </head>
    <body>
        <div id="div_container_login">
            <h1>Log in - Sign up Test Firebase WAWA</h1>

            <input id="txtEmail" class="form-control" type="email" placeholder="Email">

            <input id="txtPassword" class="form-control" type="password" placeholder="Password"> <br>

            <button id="btnLogin" class="btn btn-outline-primary"> Login</button>

            <button id="btnSignUp" class="btn btn-outline-secondary">Sign Up</button>

            <button id="btnLogout" class="btn btn-outline-primary invisible">Log out</button>

            <h2 id="h2_logState"></h2>

        </div>

        <div id="div_container_resetPassword">
                <h1>Restore password Test Firebase WAWA</h1>
                <input id="txtEmail_reset" class="form-control" type="email" placeholder="Email"><br>
                <button id="btnResetPassword" class="btn btn-outline-primary"> Send reset message</button>
                <h2 id="h2_resetState"></h2>
        </div>
    </body>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDrEzkF2cp1wyvMtKmELnxHKG8_9O1NiYA",
            authDomain: "wawa-3f4f7.firebaseapp.com",
            databaseURL: "https://wawa-3f4f7.firebaseio.com",
            storageBucket: "wawa-3f4f7.appspot.com",
        };
        // Inicio Firebase
        firebase.initializeApp(firebaseConfig);
        


        

        //trae los elementos necesarios del DOM
        const txtEmail = document.getElementById("txtEmail");
        const txtPassword = document.getElementById("txtPassword");
        const txtEmailReset= document.getElementById("txtEmail_reset");

        const btnLogin = document.getElementById("btnLogin");
        const btnSignUp = document.getElementById("btnSignUp");
        const btnLogout = document.getElementById("btnLogout");
        const btnReset = document.getElementById("btnResetPassword");

        const h2State = document.getElementById("h2_logState");
        const h2Reset = document.getElementById("h2_resetState");

        //agregacion del evento login
        btnLogin.addEventListener('click', e=>{
            const email = txtEmail.value;
            const pass = txtPassword.value;
            const auth = firebase.auth();


            //sign in
            const promise = auth.signInWithEmailAndPassword(email,pass);
            promise.catch(e=> {
                console.log(e);
                alert(e);
                });

        });

        //agregacion del evento signin
        btnSignUp.addEventListener('click', e=>{
            const email = txtEmail.value;
            const pass = txtPassword.value;
            const auth = firebase.auth();


            //sign up
            const promise = auth.createUserWithEmailAndPassword(email,pass);
            promise.catch(e=> {
                console.log(e);
                alert(e);
                });
        });

        //agregacion del evento logout
        btnLogout.addEventListener('click', e=>{
            firebase.auth().signOut();
        });

        btnReset.addEventListener('click', e=>{
            const email = txtEmailReset.value;
            const auth = firebase.auth();
            h2Reset.innerHTML = "if the email exist, you will receive a message";

            const promise = auth.sendPasswordResetEmail(email);
            promise.catch(e=>{
                console.log(e);
                alert(e);
            });
        });

        //respuestas de firebase con su cambio de estado
        firebase.auth().onAuthStateChanged(firebaseUser =>{
            if(firebaseUser){
                console.log("logged in");
                alert("logged in");
                h2State.innerHTML = "Sesi√≥n iniciada";
                btnLogin.className ="btn btn-outline-primary  invisible";
                btnSignUp.className ="btn btn-outline-primary  invisible";
                btnLogout.className ="btn btn-outline-primary";
            }
            else{
                console.log('not logged in');
                alert("not Logged in");
                h2State.innerHTML = "";
                btnLogin.className ="btn btn-outline-primary";
                btnSignUp.className ="btn btn-outline-primary";
                btnLogout.className ="btn btn-outline-primary  invisible";
            }
        });
    </script>
</html>